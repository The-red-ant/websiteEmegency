<--This File was create after many and many AI promts and refiment and web assistence-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Interactive Alert Map</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfgdEelsOdJQsNX4zs54R-TnRej4UAv6c&libraries=geometry,places"></script>

    <style>
        #map {
            height: 70vh;
            width: 100%;
        }
    </style>
</head>

<body class="bg-light">
<div class="container my-3">
    <h1 class="text-center">Community Alert Map</h1>
    <p class="text-center">Click on the map to place your alert marker.</p>

    <div id="map"></div> <!-- Map Container -->
</div>

<script>
    let map;
    let alerts = [];

    const alertIcons = {
        "Help Required": "https://maps.google.com/mapfiles/kml/shapes/info-i_maps.png",
        "Help Offered": "https://maps.google.com/mapfiles/kml/pal3/icon44.png",
        "Warning": "https://maps.google.com/mapfiles/kml/pal3/icon41.png",
        "Danger": "https://maps.google.com/mapfiles/kml/pal3/icon37.png",
    };

    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: {lat: 26.08047, lng: -80.23380},
            zoom: 14,
        });

        // Load alerts from the JSON file
        fetch('alerts.json')  // Adjust path as needed
        .then(response => response.json())
        .then(data => {
            alerts = data;
            data.forEach(alert => createAlertMarker(alert));
        })
        .catch(error => console.error('Error loading the alerts:', error));

        map.addListener('click', function (mapsMouseEvent) {
            showForm(mapsMouseEvent.latLng);
        });
    }

    function showForm(latLng) {
        const formHtml = `
            <h4>Add New Alert</h4>
            <form>
                <label for="type">Alert Type:</label>
                <select id="type" onchange="toggleHelpDetails(this.value)">
                    <option value="Help Required">Help Required</option>
                    <option value="Help Offered">Help Offered</option>
                    <option value="Warning">Warning</option>
                    <option value="Danger">Danger</option>
                </select>
                <br>
                <div id="helpDetails" style="display:none;">
                    <label for="name">Your Name:</label>
                    <input type="text" id="name" required>
                    <br>
                    <label for="phone">Your Phone:</label>
                    <input type="text" id="phone" required>
                    <br>
                </div>
                <label for="description">Description:</label>
                <input type="text" id="description" required>
                <br>
                <button type="button" onclick="addAlert('${latLng.toJSON().lat}', '${latLng.toJSON().lng}')">Submit Alert</button>
            </form>
        `;

        const infoWindow = new google.maps.InfoWindow({
            content: formHtml,
            position: latLng
        });

        infoWindow.open(map);
    }

    function toggleHelpDetails(value) {
        const helpDetails = document.getElementById('helpDetails');
        if (value === 'Help Required' || value === 'Help Offered') {
            helpDetails.style.display = 'block';
        } else {
            helpDetails.style.display = 'none';
        }
    }

    function addAlert(lat, lng) {
        const type = document.getElementById("type").value;
        const description = document.getElementById("description").value;
        const name = type.includes("Help") ? document.getElementById("name").value : "";
        const phone = type.includes("Help") ? document.getElementById("phone").value : "";

        if (!description) {
            alert("Please fill out the description.");
            return;
        }

        const newAlert = {
            latitude: parseFloat(lat),
            longitude: parseFloat(lng),
            type: type,
            description: description,
            name: name,
            phone: phone
        };

        createAlertMarker(newAlert);
        alert("Alert added successfully!");
    }

    function createAlertMarker(alert) {
        const marker = new google.maps.Marker({
            position: {lat: parseFloat(alert.latitude), lng: parseFloat(alert.longitude)},
            map: map,
            icon: alertIcons[alert.type],
            title: alert.description
        });

        const infoWindow = new google.maps.InfoWindow({
            content: generateInfoContent(alert)
        });

        marker.addListener("click", () => {
            infoWindow.open(map, marker);
        });

        if (alert.type === "Danger") {
            drawDangerZone(alert.latitude, alert.longitude);
        }
    }

    function generateInfoContent(alert) {
        return `
            <h5>${alert.type}</h5>
            <p>${alert.description}</p>
            ${alert.type.includes("Help") ? `<p>Contact: ${alert.name}, ${alert.phone}</p>` : ""}
        `;
    }

    function drawDangerZone(lat, lng) {
        new google.maps.Circle({
            strokeColor: "#FF0000",
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: "#FF0000",
            fillOpacity: 0.35,
            map,
            center: {lat, lng},
            radius: 300, // 300 meters radius for visual impact
        });
    }

    window.onload = initMap;
</script>
</body>
</html>
